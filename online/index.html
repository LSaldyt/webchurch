<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>WebChurch</title>
    <link rel="stylesheet" href="../css/codemirror.css">
    <link rel="stylesheet" href="../css/d3.css">
    <script src="store.js"></script>
    <script src="jquery.js"></script>
    <script src="webchurch.js"></script>
    <script src="d3.min.js"></script>
    <script src="vega.min.js"></script>
    <style>
      body {
        font-family: Helvetica;
        font-size: 120%;
        width: 60%;
        margin: auto;
      }

      button {
      /*font-size: 14px*/
      }
      button.reset {
        float: right
      }
      button.run {
      /*padding-top: 5px;
        padding-bottom: 5px;*/
      }
      select {
      /*font-size: 20px;*/
      }
      ul {
        font-size: 12px
      }
      li code {
        border: 1px solid #aaa;
        border-radius: 3px;
        padding: 1px 3px 1px 3px;
        background-color: #dfdfdf
      }
      li {
        padding-top: 8px
      }
      p.error {
        font-size: 120%;
      }

      .code-controls {
      position: absolute;
      bottom: 0;
      right: 0;
      opacity: 0;
      z-index: 1000
      }

      .code-settings {
      z-index: 999;
      position: absolute;
      top: 0;
      right: 0;
      font-size: 16px;
      list-style-type: none;
      margin: 2px
      }

      .code-settings li {
      display: none;
      }

      .code-settings .settings-icon {
      display: inline;
      opacity: 0.3;
      }

      .code-settings:hover li {
      opacity: 1.0;
      display: inline
      }

      .CodeMirror:hover .code-controls, .CodeMirror-focused .code-controls {
      opacity: 1
      }

    </style>

  </head>
  <body>
    <h1>WebChurch</h1>

    Keyboard shortcuts:
    <ul>
      <li> <code>Cmd + .</code>&nbsp; or &nbsp;<code>Ctrl + .</code> - Fold selected section (slightly buggy right now)</li>
      <li> <code>Cmd + ;</code>&nbsp; or &nbsp;<code>Ctrl + ;</code> - Comment selection section</li>
    </ul></br>


    <pre id="codebox"><code>
;; (define (dim) (uniform 5 20))
;; (define (staticDim) (uniform 10 50))
;; (define (shape) (if (flip) "circle" "rect"))
;; (define (xpos) (uniform 100 (- worldWidth 100)))
;; (define (ypos) (uniform 100 (- worldHeight 100)))

;; ;; an object in the word is a list of two things:
;; ;;  shape properties: a list of SHAPE ("rect" or "circle"), IS_STATIC (#t or #f),
;; ;;                    and dimensions (either (list WIDTH HEIGHT) for a rect or
;; ;;                    (list RADIUS) for a circle
;; ;;  position: (list X Y)
;; (define (makeFallingShape) (list (list (shape) #f (list (dim) (dim)))
;;                                        (list (xpos) 0)))

;; (define (makeStaticShape) (list (list (shape) #t (list (staticDim) (staticDim)))
;;                                       (list (xpos) (ypos))))

;; (define ground (list (list "rect" #t (list worldWidth 10))
;;                                      (list (/ worldWidth 2) worldHeight)))
;; (define fallingWorld (list ground
;;                            (makeFallingShape) (makeFallingShape) (makeFallingShape)
;;                            (makeStaticShape) (makeStaticShape)))

;; (runPhysics 1000 fallingWorld)

(define (dim) (uniform 5 20))
(define (staticDim) (uniform 10 50))
(define (pos) (uniform 100 300))

(define (aDim) (p.dim2D (dim) (dim)))
(define (aStaticDim) (p.dim2D (staticDim) (staticDim))) ; static obstacles are generally larger than falling objects
(define (aPos) (p.pos2D (pos) 0))                       ; start falling-body from top
(define (aStaticPos) (p.pos2D (pos) (pos)))

(define (aShape) (uniform-draw (p.shapeTypes)))

(define (fallingEntity) (p.dynamicEntity (p.shape2D (aShape) (aDim)) (aPos)))
(define (staticEntity) (p.staticEntity (p.shape2D (aShape) (aStaticDim)) (aStaticPos)))
(define ground (p.staticEntity (p.shape2D p.rectangle (p.dim2D 350 10)) (p.pos2D 180 500)))
(define my_world
        (p.makeFallingWorld
          (list ground
                (fallingEntity) (fallingEntity) (fallingEntity)
                (staticEntity) (staticEntity))))

(define simResults (p.runPhysics 1000 my_world))
(map p.entity2D_position (filter (lambda (e) (equal? (p.entity2D_type e) p.dynamicType)) simResults))
</code></pre>

  </body>
  <script>
    var savedCode = store.get('code');
    var code = savedCode || $("#codebox > code").text();

    var editor = require('./editor').injector($("#codebox")[0],
    {
    code: code,
    engine: "webchurch",
    }
    );

    editor.supplant( $("#codebox")[0] )

    editor.on('run.start', function() {
    store.set('code', this.get('code'));
    })

  </script>
</html>
